<% content_for :head do %>
    <% unless @trip.points.empty? %>
      <%= javascript_include_tag '//maps.googleapis.com/maps/api/js?sensor=false' %>
      <%= javascript_tag do %>
            var markers = [];
            var map;

            function map() {
              var first = new google.maps.LatLng(<%= @trip.points.first.lat %>, <%= @trip.points.first.lng %>);
              var mapOptions = {
                zoom: 13,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                center: first
              };
              map = new google.maps.Map(document.getElementById("map"),
                      mapOptions);
            <% @trip.points.all.each do |point| %>
              new google.maps.Marker({
                map: map,
                draggable: true,
                animation: google.maps.Animation.DROP,
                position: new google.maps.LatLng(<%= point.lat %>, <%= point.lng %>)
              });
            <% end %>
            }
      <% end %>
    <% end %>
<% end %>
<div id="wrapper">
  <% if flash[:error] %>
  <div class="alert alert-error">
    <%= flash[:error] %>
    <a class="close" href="<%= trip_path(@trip) %>">×</a>
  </div>
  <% end %>
  <% if flash[:info] %>
  <div class="alert alert-info">
    <%= flash[:info] %>
    <a class="close" href="<%= trip_path(@trip) %>">×</a>
  </div>
  <% end %>
  <% if flash[:success] %>
  <div class="alert alert-success">
    <%= flash[:success] %>
    <a class="close" href="<%= trip_path(@trip) %>">×</a>
  </div>
  <% end %>
  <% if current_user && (current_user.admin? || current_user == @trip.user) %>
  <span class="pull-right">
    <%= link_to image_tag("edit.svg", :size => "32x32", :title => "Edytuj podróż", :alt => "Edytuj podróż"), edit_trip_path(@trip) %>
    <%= link_to image_tag("delete.svg", :size => "32x32", :title => "Usuń podróż", :alt => "Usuń podróż"), @trip, :method => :delete, :confirm => 'Na pewno chcesz usunąć podróż?' %>
  </span>
  <% end %>
  <h1><%= @trip.name %></h1>
  <h3>autor: <%= link_to @trip.user.login, @trip.user %></h3>
  <div class="description">
    <%= simple_format(@trip.description) %>
  </div>
  <% unless @trip.points.empty? %>
    <div id="map" style="width: 99%; height: 200px">
      Map
    </div>
    <br />
    <h3>Punkty podróży</h3>
    <div id="points">
      <% @trip.points.all.each do |point| %>
      <div class="point" id="point-<%= point.id %>">
        <h4 class="nextto"><%= point.name %></h4>
        <%= link_to_function 'Wskaż na mapie', %{ map.setCenter(new google.maps.LatLng(#{point.lat}, #{point.lng})) } %>
        <% unless point.description.empty? %>
        <div class="description"><%= simple_format(point.description) %></div>
        <% end %>
      </div>
      <% end %>
    </div>
  <% end %>
  <%= link_to 'Wszystkie podróże', trips_path %>&nbsp;&middot;&nbsp;<%= link_to 'Profil autora', @trip.user %>
</div>

